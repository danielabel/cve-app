package builders;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ArrayNode;
import com.fasterxml.jackson.databind.node.ObjectNode;

import java.io.File;
import java.io.IOException;

public class NvdTestData {
    private final static File frameFile = new File("src/test/resources/nvd-nist-gov-frames/nvd-nist-gov-result-outline.json");
    private final static File cveFile = new File("src/test/resources/nvd-nist-gov-frames/cve-frame.json");


    private final static ObjectMapper objectMapper = new ObjectMapper();

    public static JsonNode build(int requiredCves) throws IOException {
        ObjectNode resultFrame = (ObjectNode)objectMapper.readTree(frameFile);
        ObjectNode cveFrame = (ObjectNode)objectMapper.readTree(cveFile);
        for(int i = 0; i < requiredCves ; i++) {
            ObjectNode cve = cveFrame.deepCopy();

            ArrayNode descArray = (ArrayNode)cve.findValue("description_data");
            ((ObjectNode)descArray.get(0)).put("value", "description " + i);

            ((ArrayNode)resultFrame.findPath("CVE_Items")).add(cve);
        }

        return resultFrame;
    }
}
