package co.uk.twicezero.cveappservice.domain;

import com.jayway.jsonpath.DocumentContext;
import com.jayway.jsonpath.JsonPath;

import java.util.ArrayList;
import java.util.List;

public class ProcessUpstreamData {

    public static ResultsSummary buildResultsSummary(String responseBody) {
        String jsonpathTotalResults = "$['totalResults']";
        String jsonpathCVEDescription = "$['result']['CVE_Items'][*]['cve']['description']['description_data'][0]['value']";

        DocumentContext jsonContext = JsonPath.parse(responseBody);
        int totalResults = jsonContext.read(jsonpathTotalResults);
        List<String> items = jsonContext.read(jsonpathCVEDescription);

        //Todo: this should be a map
        ArrayList<ResultsSummary.Cve> cves = new ArrayList<>();
        for (String i : items) {
            cves.add(new ResultsSummary.Cve(i));
        }

        ResultsSummary results = new ResultsSummary(totalResults, cves);
        return results;
    }
}
