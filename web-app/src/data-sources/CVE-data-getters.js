function addShortDescription(item) {
  if (item.description.length > 35) {
    item.shortDesc = item.description.substring(0, 34) + "...";
  } else {
    item.shortDesc = item.description;
  }
}

async function searchResultTransform(rawJson) {
  if (!rawJson.topResults) return rawJson;

  rawJson.topResults.map((item) => {
    addShortDescription(item);
    return item;
  });

  return rawJson;
}

async function fetcher(url) {
  let response;
  try {
    response = await fetch(url);
  } catch (fetchError) {
    throw new Error('failed to get data');
  }

  if (response.status !== 200) {
    throw new Error('failed to get data');
  }
  return response;
}

async function getCVEs (searchTerm) {
  const response = await fetcher(`http://localhost:8080/cve/search?for=${searchTerm}`);
  return searchResultTransform(await response.json());
}

export {
  getCVEs,
};
