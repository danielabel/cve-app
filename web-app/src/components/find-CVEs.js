import React, { useState } from 'react';
import Container from 'react-bootstrap/Container';

import SearchBar from "./search.js";
import { CVEsSummaryTable } from "./CVEs-summary-table";

import {getCVEs} from '../data-sources/CVE-data-getters';
import {CVEDetails} from "./CVE-details";

export default function FindCVEs() {
 const [CVEs, setCVEs] = useState([]);
  const [details, setDetails] = useState(null);
 const [erredSearch, setErredSearch] = useState(null);


  function showSearch() {
    setDetails(null);
  }

  async function doSearch (searchString) {
   try {
     const result = await getCVEs(searchString);
     setCVEs(result);
   } catch(e) {
     console.log('failed to search for CVEs', e);
     setErredSearch(e.message);
   }
 }

  async function showDetails (CVE) {
   console.log(CVE);
    setDetails(CVE);
  }

  // and now the render!
 if (erredSearch) {
   return (<div>Failed to get result of search: {erredSearch}</div>)
 }

  if (details) {
    return (<CVEDetails CVE={details}
                         close={showSearch}
    />)
  }

  return (
   <Container>
     <SearchBar searchTrigger={ doSearch }/>
     <CVEsSummaryTable CVESummaries={CVEs.topResults} selectTrigger={showDetails}/>
   </Container>
 );
}
